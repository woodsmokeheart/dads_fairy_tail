# ğŸ”Œ API Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹

## ĞĞ±Ğ·Ğ¾Ñ€ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²

ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¾ Ğ½Ğ° Ğ¼Ğ½Ğ¾Ğ³Ğ¾ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ğ¾Ğ¹ ÑĞµÑ€Ğ²Ğ¸ÑĞ½Ğ¾Ğ¹ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğµ Ñ Ñ‡ĞµÑ‚ĞºĞ¸Ğ¼ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸ĞµĞ¼ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         React Components             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ inject()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Services Layer                â”‚
â”‚  (Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¸ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Repositories Layer              â”‚
â”‚  (Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼ Ğ¸ ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Supabase Client                  â”‚
â”‚  (PostgreSQL, Auth, Storage)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š StoriesService

Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ ÑĞ¾ ÑĞºĞ°Ğ·ĞºĞ°Ğ¼Ğ¸.

**Ğ Ğ°ÑĞ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ**: `src/services/stories.ts`  
**Ğ˜Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ**: `IStoriesService`

### ĞœĞµÑ‚Ğ¾Ğ´Ñ‹

#### `getStories(filters?: StoryFilters): Promise<Story[]>`

ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° ÑĞºĞ°Ğ·Ğ¾Ğº Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹.

**ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
```typescript
interface StoryFilters {
  author_id?: string;       // Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ñƒ
  search?: string;          // ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ñ‚ĞµĞºÑÑ‚Ñƒ
  is_published?: boolean;   // Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ
}
```

**Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:**
```typescript
Story[] // ĞœĞ°ÑÑĞ¸Ğ² ÑĞºĞ°Ğ·Ğ¾Ğº
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
const storiesService = inject('storiesService');

// Ğ’ÑĞµ Ğ¾Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞºĞ°Ğ·ĞºĞ¸
const stories = await storiesService.getStories({ 
  is_published: true 
});

// Ğ¡ĞºĞ°Ğ·ĞºĞ¸ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ°
const authorStories = await storiesService.getStories({ 
  author_id: 'user-123' 
});
```

---

#### `getStoriesPaginated(filters?: StoryFilters, pagination?: PaginationOptions): Promise<PaginatedStoriesResponse>`

ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞºĞ°Ğ·Ğ¾Ğº Ñ Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸ĞµĞ¹.

**ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
```typescript
interface PaginationOptions {
  page?: number;          // ĞĞ¾Ğ¼ĞµÑ€ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ (default: 1)
  limit?: number;         // Ğ¡ĞºĞ°Ğ·Ğ¾Ğº Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ (default: 10)
  sortBy?: 'created_at' | 'title' | 'updated_at';
  sortOrder?: 'asc' | 'desc';
}
```

**Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:**
```typescript
interface PaginatedStoriesResponse {
  stories: Story[];
  totalCount: number;
  currentPage: number;
  totalPages: number;
  hasNextPage: boolean;
  hasPreviousPage: boolean;
}
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
// ĞŸĞµÑ€Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ñ 6 ÑĞºĞ°Ğ·ĞºĞ°Ğ¼Ğ¸
const result = await storiesService.getStoriesPaginated(
  { is_published: true },
  { page: 1, limit: 6 }
);

console.log(`Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° ${result.currentPage} Ğ¸Ğ· ${result.totalPages}`);
console.log(`Ğ’ÑĞµĞ³Ğ¾ ÑĞºĞ°Ğ·Ğ¾Ğº: ${result.totalCount}`);
```

---

#### `getStoryById(id: string): Promise<Story | null>`

ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ÑĞºĞ°Ğ·ĞºĞ¸ Ğ¿Ğ¾ ID.

**ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
- `id: string` - UUID ÑĞºĞ°Ğ·ĞºĞ¸

**Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:**
- `Story` - ĞµÑĞ»Ğ¸ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°
- `null` - ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
const story = await storiesService.getStoryById('story-uuid');

if (story) {
  console.log(story.title);
} else {
  console.log('Ğ¡ĞºĞ°Ğ·ĞºĞ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°');
}
```

---

#### `createStory(data: CreateStoryData): Promise<Story>`

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ ÑĞºĞ°Ğ·ĞºĞ¸.

**ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
```typescript
interface CreateStoryData {
  title: string;           // ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ (Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)
  content: string;         // JSON Ğ¾Ñ‚ Tiptap (Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)
  cover_image?: File;      // Ğ¤Ğ°Ğ¹Ğ» Ğ¾Ğ±Ğ»Ğ¾Ğ¶ĞºĞ¸ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
  is_published?: boolean;  // Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ (default: true)
}
```

**Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ:**
- ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğµ Ğ¿ÑƒÑÑ‚Ğ¾Ğµ
- Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ Ğ½Ğµ Ğ¿ÑƒÑÑ‚Ğ¾Ğµ
- ĞĞ±Ğ»Ğ¾Ğ¶ĞºĞ°: max 5MB, Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‹ JPG/PNG/WEBP

**Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:**
```typescript
Story // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ğ°Ñ ÑĞºĞ°Ğ·ĞºĞ°
```

**ĞÑˆĞ¸Ğ±ĞºĞ¸:**
- `"ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞºĞ°Ğ·ĞºĞ¸ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼"`
- `"Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ ÑĞºĞ°Ğ·ĞºĞ¸ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼"`
- `"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¾Ğ±Ğ»Ğ¾Ğ¶ĞºĞ¸"`

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
try {
  const newStory = await storiesService.createStory({
    title: 'Ğ’Ğ¾Ğ»ÑˆĞµĞ±Ğ½Ñ‹Ğ¹ Ğ»ĞµÑ',
    content: JSON.stringify(tiptapContent),
    cover_image: coverFile,
    is_published: true
  });
  
  console.log('Ğ¡ĞºĞ°Ğ·ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°:', newStory.id);
} catch (error) {
  console.error('ĞÑˆĞ¸Ğ±ĞºĞ°:', error.message);
}
```

---

#### `updateStory(id: string, data: UpdateStoryData): Promise<Story>`

ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ¹ ÑĞºĞ°Ğ·ĞºĞ¸.

**ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
```typescript
interface UpdateStoryData {
  title?: string;
  content?: string;
  cover_image?: File;
  is_published?: boolean;
}
```

**Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ:**
- Ğ•ÑĞ»Ğ¸ title ÑƒĞºĞ°Ğ·Ğ°Ğ½, Ğ¾Ğ½ Ğ½Ğµ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼
- Ğ•ÑĞ»Ğ¸ content ÑƒĞºĞ°Ğ·Ğ°Ğ½, Ğ¾Ğ½ Ğ½Ğµ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼

**Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:**
```typescript
Story // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ğ°Ñ ÑĞºĞ°Ğ·ĞºĞ°
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
const updatedStory = await storiesService.updateStory('story-id', {
  title: 'ĞĞ¾Ğ²Ğ¾Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ',
  is_published: true
});
```

---

#### `deleteStory(id: string): Promise<void>`

Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑĞºĞ°Ğ·ĞºĞ¸.

**ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
- `id: string` - UUID ÑĞºĞ°Ğ·ĞºĞ¸

**Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:**
- `void` (Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾)

**ĞÑˆĞ¸Ğ±ĞºĞ¸:**
- Ğ•ÑĞ»Ğ¸ ÑĞºĞ°Ğ·ĞºĞ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°
- Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ½Ğ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
await storiesService.deleteStory('story-id');
console.log('Ğ¡ĞºĞ°Ğ·ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ°');
```

---

#### `getUserStories(userId: string): Promise<Story[]>`

ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ²ÑĞµÑ… ÑĞºĞ°Ğ·Ğ¾Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ.

**ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
- `userId: string` - UUID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

**Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:**
```typescript
Story[] // ĞœĞ°ÑÑĞ¸Ğ² ÑĞºĞ°Ğ·Ğ¾Ğº Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ°
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
const myStories = await storiesService.getUserStories(user.id);
console.log(`Ğ£ Ğ²Ğ°Ñ ${myStories.length} ÑĞºĞ°Ğ·Ğ¾Ğº`);
```

---

#### `searchStories(query: string): Promise<Story[]>`

ĞŸĞ¾Ğ¸ÑĞº ÑĞºĞ°Ğ·Ğ¾Ğº Ğ¿Ğ¾ Ñ‚ĞµĞºÑÑ‚Ñƒ.

**ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
- `query: string` - ĞŸĞ¾Ğ¸ÑĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ

**Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:**
```typescript
Story[] // ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğµ ÑĞºĞ°Ğ·ĞºĞ¸
```

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ¼Ñƒ
- Case-insensitive
- ĞŸÑƒÑÑ‚Ğ¾Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ â†’ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ Ğ¼Ğ°ÑÑĞ¸Ğ²

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
const results = await storiesService.searchStories('Ğ²Ğ¾Ğ»ÑˆĞµĞ±Ğ½Ñ‹Ğ¹');
console.log(`ĞĞ°Ğ¹Ğ´ĞµĞ½Ğ¾ ÑĞºĞ°Ğ·Ğ¾Ğº: ${results.length}`);
```

---

## ğŸ“¤ FileUploadService

Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ² Supabase Storage.

**Ğ Ğ°ÑĞ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ**: `src/services/FileUploadService.ts`

### ĞœĞµÑ‚Ğ¾Ğ´Ñ‹

#### `uploadCoverImage(file: File, storyId: string): Promise<string>`

Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¾Ğ±Ğ»Ğ¾Ğ¶ĞºĞ¸ Ğ´Ğ»Ñ ÑĞºĞ°Ğ·ĞºĞ¸.

**ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
- `file: File` - Ğ¤Ğ°Ğ¹Ğ» Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
- `storyId: string` - ID ÑĞºĞ°Ğ·ĞºĞ¸

**Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:**
```typescript
string // ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ URL Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°
```

**Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ:**
- Ğ Ğ°Ğ·Ğ¼ĞµÑ€: max 5MB
- Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‹: image/jpeg, image/png, image/webp

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
const fileService = inject('fileUploadService');

const url = await fileService.uploadCoverImage(
  coverFile,
  'story-uuid'
);

console.log('ĞĞ±Ğ»Ğ¾Ğ¶ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ°:', url);
```

---

#### `deleteCoverImage(storyId: string): Promise<void>`

Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ±Ğ»Ğ¾Ğ¶ĞºĞ¸ ÑĞºĞ°Ğ·ĞºĞ¸.

**ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
- `storyId: string` - ID ÑĞºĞ°Ğ·ĞºĞ¸

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
await fileService.deleteCoverImage('story-uuid');
```

---

## ğŸ“ LoggerService

Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ.

**Ğ Ğ°ÑĞ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ**: `src/services/LoggerService.ts`  
**Ğ˜Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ**: `ILogger`

### ĞœĞµÑ‚Ğ¾Ğ´Ñ‹

#### `info(message: string, ...args: unknown[]): void`

Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
const logger = inject('logger');
logger.info('ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ¾ÑˆĞµĞ» Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ', { userId: '123' });
```

---

#### `debug(message: string, ...args: unknown[]): void`

ĞÑ‚Ğ»Ğ°Ğ´Ğ¾Ñ‡Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² dev).

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
logger.debug('API call', { endpoint: '/stories', params });
```

---

#### `warn(message: string, ...args: unknown[]): void`

ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
logger.warn('ĞšĞµÑˆ ÑƒÑÑ‚Ğ°Ñ€ĞµĞ»', { key: 'stories' });
```

---

#### `error(message: string, ...args: unknown[]): void`

ĞÑˆĞ¸Ğ±ĞºĞ°.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
try {
  await someOperation();
} catch (error) {
  logger.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸', error);
}
```

---

## ğŸ’¾ StoriesRepository

Ğ ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ‘Ğ” (ÑĞ»Ğ¾Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼).

**Ğ Ğ°ÑĞ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ**: `src/repositories/StoriesRepository.ts`  
**Ğ˜Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ**: `IStoriesRepository`

### ĞœĞµÑ‚Ğ¾Ğ´Ñ‹

Ğ˜Ğ¼ĞµĞµÑ‚ Ñ‚Ğµ Ğ¶Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹, Ñ‡Ñ‚Ğ¾ Ğ¸ StoriesService, Ğ½Ğ¾ Ğ±ĞµĞ· Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸. ĞĞ°Ğ¿Ñ€ÑĞ¼ÑƒÑ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ Supabase.

#### ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:

1. **ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· ExecutionQueue**
   ```typescript
   const stories = await this._executionQueue.execute(
     ['stories', 'paginated', page],
     () => this._fetchStoriesFromDB(),
     { ttl: 60000 } // ĞšĞµÑˆ Ğ½Ğ° 1 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ
   );
   ```

2. **SQL Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ñ‡ĞµÑ€ĞµĞ· Supabase**
   ```typescript
   const { data, error } = await supabase
     .from('stories')
     .select('*, profiles!stories_author_id_fkey(*)')
     .eq('is_published', true)
     .order('created_at', { ascending: false });
   ```

3. **Ğ¢Ñ€Ğ°Ğ½ÑÑ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…**
   ```typescript
   // ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ‘Ğ” Ğ² Ñ‚Ğ¸Ğ¿Ñ‹ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
   const stories: Story[] = data.map(row => ({
     id: row.id,
     title: row.title,
     content: row.content,
     author: {
       id: row.profiles.id,
       username: row.profiles.username
     }
   }));
   ```

---

## ğŸ”„ ExecutionQueue

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°Ğ¼Ğ¸.

**Ğ Ğ°ÑĞ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ**: `src/libs/async/ExecutionQueue.ts`

### ĞœĞµÑ‚Ğ¾Ğ´Ñ‹

#### `execute<T>(key: string[], fn: () => Promise<T>, options?: ExecuteOptions): Promise<T>`

Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ñ ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼.

**ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
```typescript
interface ExecuteOptions {
  ttl?: number;          // Time to live (ms)
  forceRefresh?: boolean; // Ğ˜Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞµÑˆ
}
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
const queue = inject('executionQueue');

const data = await queue.execute(
  ['user', userId, 'stories'],
  () => fetchUserStories(userId),
  { ttl: 60000 } // 1 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ°
);
```

---

#### `clearCache(key: string[]): void`

ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡Ğ° ĞºĞµÑˆĞ°.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
queue.clearCache(['user', '123', 'stories']);
```

---

#### `clearCacheByPattern(pattern: string[]): void`

ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ĞºĞµÑˆĞ° Ğ¿Ğ¾ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñƒ.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```typescript
// ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ ĞºĞµÑˆĞ¸, ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾ ÑĞºĞ°Ğ·ĞºĞ°Ğ¼Ğ¸
queue.clearCacheByPattern(['stories']);

// ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ĞºĞµÑˆ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
queue.clearCacheByPattern(['user', userId]);
```

---

## ğŸ—„ï¸ Supabase API

### Database

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹:

**profiles**
```sql
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  username TEXT NOT NULL,
  avatar_url TEXT,
  is_moderator BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

**stories**
```sql
CREATE TABLE stories (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  title TEXT NOT NULL,
  content TEXT NOT NULL,           -- JSON Ğ¾Ñ‚ Tiptap
  content_text TEXT NOT NULL,      -- Ğ§Ğ¸ÑÑ‚Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ°
  cover_image_url TEXT,
  author_id UUID REFERENCES profiles(id) ON DELETE CASCADE,
  is_published BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### Row Level Security (RLS)

#### ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ stories:

**SELECT (Ñ‡Ñ‚ĞµĞ½Ğ¸Ğµ)**
```sql
-- Ğ’ÑĞµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¾Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞºĞ°Ğ·ĞºĞ¸
CREATE POLICY "Anyone can view published stories"
ON stories FOR SELECT
USING (is_published = true OR auth.uid() = author_id);
```

**INSERT (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ)**
```sql
-- Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¼Ğ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ñ‹ Ğ¼Ğ¾Ğ³ÑƒÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ
CREATE POLICY "Moderators can create stories"
ON stories FOR INSERT
TO authenticated
WITH CHECK (
  EXISTS (
    SELECT 1 FROM profiles
    WHERE profiles.id = auth.uid()
    AND profiles.is_moderator = true
  )
);
```

**UPDATE (Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ)**
```sql
-- ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ñ‹ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ»ÑĞ±Ñ‹Ğµ
CREATE POLICY "Moderators can update stories"
ON stories FOR UPDATE
TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM profiles
    WHERE profiles.id = auth.uid()
    AND profiles.is_moderator = true
  )
);
```

**DELETE (ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ)**
```sql
-- ĞœĞ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ñ‹ Ğ¼Ğ¾Ğ³ÑƒÑ‚ ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ Ğ»ÑĞ±Ñ‹Ğµ
CREATE POLICY "Moderators can delete stories"
ON stories FOR DELETE
TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM profiles
    WHERE profiles.id = auth.uid()
    AND profiles.is_moderator = true
  )
);
```

### Storage

**Bucket**: `story-covers`

**ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸:**
- Ğ’ÑĞµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ (Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ bucket)
- Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¼Ğ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ñ‹ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°Ñ‚ÑŒ
- Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¼Ğ¾Ğ´ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ñ‹ Ğ¼Ğ¾Ğ³ÑƒÑ‚ ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ

---

## ğŸ” Authentication API

### Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ

```typescript
const { data, error } = await supabase.auth.signUp({
  email: 'user@example.com',
  password: 'password123',
  options: {
    data: {
      username: 'User Name'
    }
  }
});
```

### Ğ’Ñ…Ğ¾Ğ´

```typescript
const { data, error } = await supabase.auth.signInWithPassword({
  email: 'user@example.com',
  password: 'password123'
});
```

### Ğ’Ñ‹Ñ…Ğ¾Ğ´

```typescript
await supabase.auth.signOut();
```

### ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

```typescript
const { data: { user } } = await supabase.auth.getUser();
```

### Ğ¡Ğ»ÑƒÑˆĞ°Ñ‚ĞµĞ»ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹

```typescript
const { data: { subscription } } = supabase.auth.onAuthStateChange(
  (event, session) => {
    if (event === 'SIGNED_IN') {
      console.log('ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ¾ÑˆĞµĞ»');
    }
    if (event === 'SIGNED_OUT') {
      console.log('ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ñ‹ÑˆĞµĞ»');
    }
  }
);
```

---

## ğŸ¯ Ğ¢Ğ¸Ğ¿Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Story

```typescript
interface Story {
  id: string;
  title: string;
  content: string;          // JSON Ğ¾Ñ‚ Tiptap
  content_text: string;     // Ğ§Ğ¸ÑÑ‚Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚
  cover_image_url?: string;
  author_id: string;
  is_published: boolean;
  created_at: string;
  updated_at: string;
  author?: User;
}
```

### User

```typescript
interface User {
  id: string;
  username: string;
  avatar_url?: string;
  is_moderator?: boolean;
  created_at: string;
}
```

### AuthUser

```typescript
interface AuthUser {
  id: string;
  email: string;
  is_moderator?: boolean;
  user_metadata: {
    username?: string;
    avatar_url?: string;
    created_at?: string;
    stats?: {
      stories_created: number;
      stories_published: number;
    };
  };
}
```

---

*API Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ°ĞºÑ‚ÑƒĞ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°: Ğ¾ĞºÑ‚ÑĞ±Ñ€ÑŒ 2025*

